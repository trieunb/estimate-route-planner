<div ng-controller="AddCrewRouteCtrl">
    <div class="row form-route">
        <div class="col-lg-12">
            <form-crew-route></form-crew-route>
            <hr>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-4">
            <div class="queue-header">
                <h5 class="route-box-title">Assigned Routes (<span ng-bind="assignedEstimates.length"></span>)</h5>
                <div class="queue-toolbar">
                    Sort:
                    <select class="sort-by-select"
                        ng-model="assigned_queue_sort_by"
                        ng-change="sortAssignedQueue()"
                        ng-options="sort.value as sort.label for sort in ::sortOptions">
                    </select>
                </div>
            </div>
            <div class="assigned-routes" ui-tree="assignedListDndOptions" data-max-depth="1" data-drag-delay="150">
                <ul ui-tree-nodes ng-model="assignedEstimates">
                    <li ui-tree-node class="box-assign" ng-repeat="estimate in assignedEstimates">
                        <span ui-tree-handle class="drag-handler glyphicon glyphicon-th-large"></span>
                        <a href="#/edit-estimate/{{::estimate.id}}" target="_blank" ng-if="::hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</a>
                        <span ng-if="::!hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</span>
                        <br>
                        {{:: estimate | estimateJobFullAddress }}
                        <br>
                        Phone: {{::estimate.primary_phone_number}}<br>
                        Exp: {{::estimate.expiration_date}}<br>
                        Total: ${{::estimate.total}}<br>
                        Status: {{::estimate.status}}
                    </li>
                </ul>
            </div>

            <div class="queue-header">
                <h5 class="route-box-title">Accepted Estimates (<span ng-bind="pendingEstimates.length"></span>)</h5>
                <div class="queue-toolbar">
                    Sort:
                    <select class="sort-by-select"
                        ng-model="pending_queue_sort_by"
                        ng-change="sortPendingQueue()"
                        ng-options="sort.value as sort.label for sort in ::sortOptions">
                    </select>
                </div>
            </div>
            <div class="assigned-routes" ui-tree="pendingListDndOptions" data-max-depth="1" data-drag-delay="150">
                <ul ui-tree-nodes ng-model="pendingEstimates">
                    <li ui-tree-node class="box-assign" ng-repeat="estimate in pendingEstimates">
                        <span ui-tree-handle class="drag-handler glyphicon glyphicon-th-large"></span>
                        <a href="#/edit-estimate/{{::estimate.id}}" target="_blank" ng-if="::hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</a>
                        <span ng-if="::!hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</span>
                        <br>
                        {{:: estimate | estimateJobFullAddress }}
                        <br>
                        Phone: {{::estimate.primary_phone_number}}<br>
                        Exp: {{::estimate.expiration_date}}<br>
                        Total: ${{::estimate.total}}<br>
                        Status: {{::estimate.status}}
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-sm-8">
            <div class="gmap-container">
                <ui-gmap-google-map center='map.options.center' zoom='map.options.zoom' control="map.control">
                    <ui-gmap-marker
                        icon="startMarkerIcon"
                        idkey="routeOrigin"
                        coords="routeOrigin">
                        <ui-gmap-window>
                            <p>
                                {{::routeOriginAddress}}
                            </p>
                        </ui-gmap-window>
                    </ui-gmap-marker>
                    <ui-gmap-marker ng-repeat="estimate in pendingEstimates"
                        icon="pendingMarkerIcon"
                        idkey="$index" coords="estimate.coords"
                        >
                        <ui-gmap-window>
                            <p>
                                <a href="#/edit-estimate/{{::estimate.id}}" target="_blank" ng-if="::$root.hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</a>
                                <span ng-if="::!$root.hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</span>
                                <br>
                                {{:: estimate | estimateJobFullAddress }}
                                <br>
                                Phone: {{::estimate.primary_phone_number}}<br>
                                Exp: {{::estimate.expiration_date}}<br>
                                Total: ${{::estimate.total}}<br>
                                Status: {{::estimate.status}}
                            </p>
                        </ui-gmap-window>
                    </ui-gmap-marker>

                    <ui-gmap-marker ng-repeat="estimate in assignedEstimates"
                        idkey="$index" coords="estimate.coords"
                        >
                        <ui-gmap-window>
                            <p>
                                <a href="#/edit-estimate/{{::estimate.id}}" target="_blank" ng-if="::$root.hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</a>
                                <span ng-if="::!$root.hasCap('erpp_edit_estimates')">{{::estimate.job_customer_display_name}}</span>
                                <br>
                                {{:: estimate | estimateJobFullAddress }}
                                <br>
                                Phone: {{::estimate.primary_phone_number}}<br>
                                Exp: {{::estimate.expiration_date}}<br>
                                Total: ${{::estimate.total}}<br>
                                Status: {{::estimate.status}}
                            </p>
                        </ui-gmap-window>
                    </ui-gmap-marker>

                </ui-gmap-google-map>
            </div>

            <h4 class="h4-title">Recent Saved Routes</h4>
            <table class="table table-bordered table-fixed header-fixed">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Created At</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="route in recentRoutes">
                    <td><span>{{::route.title}}</span></td>
                    <td><span>{{::route.created_at}}</span></td>
                    <td><span>{{::route.status}}</span></td>
                    <td>
                        <a href="#/edit-crew-route/{{route.id}}">View</a>
                    </td>
                  </tr>
                  <tr ng-if="!$root.isBusy && recentRoutes.length == 0">
                      <td colspan="4" class="text-center">
                          No routes created yet
                      </td>
                  </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
